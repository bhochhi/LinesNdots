<!DOCTYPE HTML5>
<html>
<head>
<meta charset="UTF-8">
<title>Dots and Lines</title>
<script>
var canvas = null;
var ctx = null;
var boxes = null;
var hr = 5;
var vt = 5;
var horizontalLines;
var verticalLines;
var startX = 100;
var startY = 100;
var boxWidth = 100;
var turn = "HUMAN";

window.addEventListener("load",function() {
	canvas = document.getElementById("game-stage");
	ctx = canvas.getContext("2d");
	canvas.addEventListener("click",executeMouseClick,false);
	canvas.addEventListener("mousemove",executeMouseover,false);
	buildStage();
},false);

function executeMouseover(ev){
var x, y;
	if (ev.layerX || ev.layerX == 0)
	{ // Firefox
		x = ev.layerX;
		y = ev.layerY;
	}
	else if (ev.offsetX || ev.offsetX == 0)
	{ // Opera
		x = ev.offsetX;
		y = ev.offsetY;
	}
	document.getElementById("pos").innerHTML = "Mouse over: "+x+","+y;
	for(idx = 0;idx<horizontalLines.length;idx++)
	{
		dx = horizontalLines[idx].xPos;
		dy = horizontalLines[idx].yPos;
		if((x>(dx+10) && x<(dx+90)) && (y>dy && y<(dy+20)))
		{
			document.body.style.cursor  = 'pointer';
			return;
		}
		else
		{
			document.body.style.cursor = 'default';
		}
	}

	for(idx in verticalLines)
	{
		dx = verticalLines[idx].xPos;
		dy = verticalLines[idx].yPos;
		if((x>dx && x<dx+20) && (y>dy+10 && y<dy+90))
		{
			document.body.style.cursor = 'pointer';
			return;
		}
		else
		{
			document.body.style.cursor = 'default';
		}
	}
}

function executeMouseClick(ev){
	var x, y;
	if (ev.layerX || ev.layerX == 0)
	{ // Firefox
		x = ev.layerX;
		y = ev.layerY;
	}
	else if (ev.offsetX || ev.offsetX == 0)
	{ // Opera
		x = ev.offsetX;
		y = ev.offsetY;
	}

	document.getElementById("pos").innerHTML = "Position clicked: "+x+","+y;
	var lineClicked = getClickedLine(x,y);
	if(lineClicked!=null && lineClicked.state!="CHECKED")
	{
		lineClicked.state = "CHECKED";
		if(lineClicked.orient == "V")
		{
			lineClicked.image.src = "grayvlinetaken.png";
		}
		else
		{
			lineClicked.image.src = "grayhlinetaken.png";
		}

		ctx.drawImage(lineClicked.image,lineClicked.xPos,lineClicked.yPos);
		turn ="MACHINE";
	}

	
}

function getClickedLine(x,y){

	//may need parent condition to limit the iteration.
	for(idx = 0;idx<horizontalLines.length;idx++)
	{
		dx = horizontalLines[idx].xPos;
		dy = horizontalLines[idx].yPos;
		if((x>(dx+10) && x<(dx+90)) && (y>dy && y<(dy+20)))
		{
			return horizontalLines[idx];
		}
	}

	for(idx in verticalLines){
		dx = verticalLines[idx].xPos;
		dy = verticalLines[idx].yPos;
		if((x>dx && x<dx+20) && (y>dy+10 && y<dy+90))
		{
			return verticalLines[idx];
		}
	}
	return null;
}

function buildStage(){

	//creating lines horizontal
	horizontalLines = new Array();
	for(i=0;i<(hr*vt+hr);i++)
	{
		var newLine = new Line();
		newLine.name = "h"+i;
		newLine.orient ="H";
		newLine.state = "NEW";
		newLine.image = new Image();
		newLine.image.src ="grayhline.png";
		horizontalLines.push(newLine);
	}

	//creating lines vertical
	verticalLines = new Array();
	for(i=0;i<(hr*vt+vt);i++)
	{
		var newLine = new Line();
		newLine.name = "v"+i;
		newLine.orient ="V";
		newLine.state = "NEW";
		newLine.image = new Image();
		newLine.image.src ="grayvline.png";
		verticalLines.push(newLine);
	}

	//creating boxes
	boxes = new Array(hr*vt);
	var k=0;
	for(j=0;j<vt;j++)
	{
		for(i=0;i<hr;i++)
		{
			var newBox = new Box();
			newBox.row = j;
			newBox.col = i;
			newBox.topLine = horizontalLines[k];
			newBox.bottomLine = horizontalLines[k+hr];
			newBox.leftLine = verticalLines[j+k];
			newBox.rightLine = verticalLines[j+k+1];
			newBox.draw_box();
			boxes[k] = newBox;
			k++;
		}
	}
}

function drawBox(){

	ctx.beginPath();
	dx = startX + this.col*100;
	dy = startY + this.row*100;
	if(this.topLine.state!="DRAWN")
	{
		ctx.drawImage(this.topLine.image,dx+5,dy)
		this.topLine.xPos = dx+5;
		this.topLine.yPos = dy;
		this.topLine.state="DRAWN";
	}
	if(this.bottomLine.state!="DRAWN")
	{
		ctx.drawImage(this.bottomLine.image,dx+5,dy+100)
		this.bottomLine.xPos = dx+5;
		this.bottomLine.yPos = dy+100;
		this.bottomLine.state="DRAWN";
	}
	if(this.leftLine.state!="DRAWN")
	{
		ctx.drawImage(this.leftLine.image,dx,dy)
		this.leftLine.xPos = dx;
		this.leftLine.yPos = dy;
		this.leftLine.state="DRAWN";
	}
	if(this.rightLine.state!="DRAWN")
	{
		ctx.drawImage(this.rightLine.image,dx+100,dy)
		this.rightLine.xPos = dx+100;
		this.rightLine.yPos = dy;
		this.rightLine.state="DRAWN";
	}
	ctx.closePath();
}

function Line(){
	this.name;
	this.xPos="";
	this.yPos="";
	this.orient;
	this.state;
	this.image;
}

function Box(){
	this.row;
	this.col;
	this.topLine;
	this.bottomLine;
	this.leftLine;
	this.rightLine;
	this.owner;
	this.draw_box=drawBox;
}

</script>
</head>
<body>
<canvas id="game-stage" width="900" height="900"><p>Your browser doesn't support canvas.</p></canvas>
<div style="width:30;position: absolute;">
<label id="pos" style="width: 300px;" > Mouse Position</label>
Player 1:<input type="text" style="width:200;" />
Player 2:<label style="width:30;position: absolute;" >Computer</label>
</div>
</body>